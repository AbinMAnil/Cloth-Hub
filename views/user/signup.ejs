<%-include('./partials/!docType')  %> 
<link rel="stylesheet" href="/stylesheets/user/signup.css">

 
<!--  
<main>
     <section class="section">
       <div class="outer" id="outer">
       
         <div class="right">
           <section>
             <form action="">
                 <div class="header">
                   <div style="margin-left: 3vw;"><h1>cloth Hub</h1></div>
                   <center><h1><span style="font-size: 25px;background-color: yellow; padding: 2px;">sign</span> In</h1></center>
                 </div>
                 <div class="form-body">
                   <center id="allTimer">
                     <div class="timer" id="timer">
                      <span class="timing" id="safeTimerDisplay">02 : 60</span>
                     </div>
                     <p> you Have <span id="chanceIndicator">4</span> chances left </p>
                   </center>
                     <input class="form otp-hide " type="text" name="" id="email" placeholder="E mail">
                   <input style="display:none" pattern="/^-?\d+\.?\d*$/" onKeyPress="if(this.value.length==10) return false;"  class="form" type="number" name="phone"   id="phone" placeholder="Phone number" >
                   <input class="form otp-hide " type="text" name="" id="password" placeholder="Password">
                  </form>
                   <input id="hide-opt" class="otp-show   form " type="text" name="" placeholder="Enter the  OTP "  pattern="/^-?\d+\.?\d*$/" onKeyPress="if(this.value.length==6) return false;">
                 </div>
                  <footer>
                  <div style="display: flex; justify-content: space-evenly; ">
                   <center  class="otp-hide"> <button type="button" onclick="simpleSubmit()" > Continue   </button></center>
                   <center id="getTheOtp" > <button type="button" class="opt-show " onclick="getOtp()"> Get the   OTP </button></center>
                   <center > <button id="reloadBtn" type="button" class="opt-show  " onclick="location.reload()"> Go Back </button></center>
                   <center class="otp-hide"> <button type="button" id="opt-btn" onclick="showOtpForm()"> Continue With  OPT  </button></center>
                   <!-- to submit the otp 
                   <center id="submitOpt" class="" style="display: none;"> <button type="button"  onclick="submitOtp()"> Submit  OTP   </button></center>
                  </div>
                   <p style="text-align: center; color: red;" id="err"></p>
 
                   <p style="text-align: center;" > don't have an Account <span style="margin-left: 1%;"><a href="/createAccount">Create Account</a></span></p>
                  </footer>
             </form>
             <#%-include('./partials/spinner') %> 
           </section>
         </div>
         <div class="left">
           <h1 class="image-text" id="image-text"><span style="background-color: white;"> continue</span> Shoping</h1>
           <div class="image">
             <div style="width:100%;height:100%;position:relative;"><iframe src="https://giphy.com/embed/l46CgonUOtSV0pxyE" width="100%" height="100%" style="position:absolute" frameBorder="0" class="giphy-embed" allowFullScreen></iframe></div>
           </div>
         </div>
       </div>
     </section>
    
   </main>
  -->

  


  <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.4.1/css/simple-line-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <style>
    body{
    background-color: #fafafa;
}

.registration-form{
	padding: 50px 0;
}

.registration-form form{
    background-color: #fff;
    max-width: 600px;
    margin: auto;
    padding: 50px 70px;
    border-top-left-radius: 30px;
    border-top-right-radius: 30px;
    box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.075);
}

.registration-form .form-icon{
	text-align: center;
    background-color: #5791ff;
    border-radius: 50%;
    font-size: 40px;
    color: white;
    width: 100px;
    height: 100px;
    margin: auto;
    margin-bottom: 50px;
    line-height: 100px;
}

.registration-form .item{
	border-radius: 8px;
    margin-bottom: 25px;
    padding: 10px 20px;
}

.registration-form .create-account{
    border-radius: 9px;
    padding: 10px 20px;
    font-size: 18px;
    font-weight: bold;
    background-color: #5791ff;
    border: none;
    color: white;
    margin-top: 20px;
    width: 50%;
}

.registration-form .social-media{
    max-width: 600px;
    background-color: #fff;
    margin: auto;
    padding: 35px 0;
    text-align: center;
    border-bottom-left-radius: 30px;
    border-bottom-right-radius: 30px;
    color: #9fadca;
    border-top: 1px solid #dee9ff;
    box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.075);
}

.registration-form .social-icons{
    margin-top: 15px;
   
 
}

.registration-form .social-icons a{
    font-size: 23px;
    margin: 0 3px;
    color: #5691ff;
    border: 1px solid;
    border-radius: 50%;
    width: 45px;
    display: inline-block;
    height: 45px;
    text-align: center;
    background-color: #fff;
    line-height: 45px;
}

.userIcon{
  font-size: 30px;
    background:#5791ff;
    width: fit-content;
    display: block;
    margin: 0 auto;
    padding: 15px;
    border-radius: 50%;
   padding: 5%;
   color: white;
   margin-bottom: 5%;
}
.registration-form .social-icons a:hover{
    text-decoration: none;
    background-color:#5791ff ;
    opacity: 0.6;
    color: black;
}
.otp{
  position: absolute; right: 36%;
  cursor: pointer;
}
.otp:hover{
  color: #5691ff;
}

@media (max-width: 576px) {
    .registration-form form{
        padding: 50px 20px;
    }

    .registration-form .form-icon{
        width: 70px;
        height: 70px;
        font-size: 30px;
        line-height: 70px;
    }
    .otp{
  position: absolute; right: 3%;
}

}

  </style>
    <div class="registration-form">
        <form>


            <div class="userIcon">
              <i class="icon icon-user mt-5"></i>
            </div>

              <!-- timer -->
          <center id="allTimer" style=""  class="shadow-sm p-2">
            <div class="timer" id="timer" style="display: block;">
             <span class="timing" id="safeTimerDisplay" style="color: red; font-size: 22px !important;">02 : 60</span>
            </div>
            <p style="font-size: 16x !important;"> you Have <span id="chanceIndicator">4</span> chances left </p>
          </center>

          <!-- end of timer -->


            <div  class="form-group">
                <input   pattern="/^-?\d+\.?\d*$/" onKeyPress="if(this.value.length==10) return false;"   type="number" class="form-control item" id="phone" placeholder="Phone Number">
            </div>


            <div id=""  class="form-group">
              <input    pattern="/^-?\d+\.?\d*$/" onKeyPress="if(this.value.length==4) return false;"   type="number" class="form-control item" id="otp" placeholder="enter the OTP">
          </div>

            <div class="form-group">
              <input  value="abinmanil80@gmail.com"   type="text" class="form-control item" id="email" placeholder="Email">
          </div>

            <div class="form-group">
                <input value="123456"  type="password" class="form-control item" id="password" placeholder="Password">
            </div>
           
          
            <div  class="form-group">
              <p id="err" style="color: red;"></p>
                <button id="simpleCont" type="button" class="btn btn-block create-account"   onclick="simpleSubmit()"  > Log in</button>
                <button id="submitPhone" type="button" class="btn btn-block create-account"   onclick="getOtp()"  > Continue</button>
                <button id="submitOtp" type="button" class="btn btn-block create-account"  onclick="submitOTPforExistUser()" > Submit </button>
            </div>
           
            <p style="" id="otpOption" class="otp" onclick="showOtpForm()"><b>Continue With OTP</b></p>
            <p style="" id="cancel" class="otp" onclick="location.reload()"><b>Cancel Go back</b></p>
        </form>
        
        <div class="social-media">
            <h5>Sign up with social media</h5>
            <div class="social-icons">
                <a href="#"><i style="line-height: 50px;"  class="icon-social-facebook" title="Facebook"></i></a>
                <a href="#"><i style="line-height: 47px;"  class="icon-social-google" title="Google"></i></a>
                <a href="#"><i  style="line-height: 47px;" class="icon-social-twitter" title="Twitter"></i></a>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.15/jquery.mask.min.js"></script>
    <script src="assets/js/script.js"></script>
</body>
</html>








          

   <script>

  


$(document).ready(function(){
  $('#cancel').hide()
  $('#allTimer').hide()
  $('#phone').hide()
  $('#submitPhone').hide();
  $('#submitOtp').hide()
  $('#birth-date').mask('00/00/0000');
  $('#otp').hide()
  $('#phone-number').mask('00000-00000');
 })

// --------

var phone;
     function showOtpForm(){
      $('#cancel').show()
       $('#otpOption').hide()
       $('#email').hide()
       $('#password').hide()
       $('#phone').show()
       $('#simpleCont').hide()
      $('#submitPhone').show();
     
      

      //  var showForms = document.getElementsByClassName('opt-show');
      //  var hideForms = document.getElementsByClassName("otp-hide")
      //  document.getElementById("phone").style.display = "block"
      //  for(var i =0 ;i<showForms.length;i++){
      //    showForms[i].style.display = "block"
      //  }
      //  for(var i =0 ;i<hideForms.length;i++){
      //    hideForms[i].style.display = "none"
      //  }
     }
 
 
     // to type otp form rendering 
 var  timer = document.getElementById('safeTimerDisplay');
 var intravel;
 var timeLimit = true;
  function stopTimer (){
    timeLimit = false;
    clearInterval(intravel);
    swal.fire("Sorry !", " Try again ", "error").then(() => {
            location.reload();
        })

  }
 function startTimer  (){
 var minute = 2;
 var second =60
 
      intravel = setInterval(()=>{
     second --;
     if(second == 0 ){
     minute --;
     second = 60;
     if(minute == 0 ){
     second = '00'
     minute = '00'
        stopTimer();
     }
     }
     timer.innerHTML ="0"+minute + ":" + second;
     
   },1000)
 
  }
   
 // request otp with phone number;
 function getOtp(){
  
    phone =  document.getElementById('phone').value
   if(phone.length != 10 ){
     document.getElementById("err").innerHTML = ""
     document.getElementById("err").innerHTML = "Ckeck the Phone Number"
   }else{

     document.getElementById("err").innerHTML = ""
     $.ajax({
              url:'/otpSignUp',
              data:{phone:parseInt(phone)},
              method:"POST",
              success:(result)=>{
                
                  if(result.status == true){
                      $('#allTimer').show()
                        $('#otp').show()
                      $('#submitOtp').show()
                      $('#submitPhone').hide()
                         startTimer();
                       
                  }else{
                    document.getElementById('id01').style.display = 'none'
                      document.getElementById("err").innerText = result.status;
                  }
              }
          })
 
   }
 }
 var checker= 4;
 
function submitOTPforExistUser(){

  let button=document.querySelector("#submitOtp");
  button.innerHTML=`<div class="text-center">
  <div class="spinner-border" role="status">
    <span class="sr-only">Loading...</span>
  </div>
</div>`
button.disabled = true;


  var otp = document.getElementById("otp").value;
   if(checker != 0 && timeLimit ){
   if( parseInt(otp.length ) == 4){
    checker--;
    document.getElementById("chanceIndicator").innerHTML = checker;
     
     document.getElementById('err').innerHTML = "";
     $.ajax({
       url:'/otpCheckForExistUser',
       data:{phone:phone, otp:otp ,  gustUserId : localStorage.getItem("userId")},
       method:"post",
       success :(result)=>{
         button.disabled = false;
         button.innerHTML = 'Submit'
          if(result.status == true){
           location.href = "/";
          }else{
            document.getElementById('err').innerHTML = "sorry wrong otp";
          }
       }
     })
     
   }else{
     document.getElementById("err").innerText = " ! Velachil  Edukalledey...."
   }
  }else{

    swal.fire("Sorry !", " Try again ", "error").then(() => {
            location.reload();
        })

  }
}


 function submitOtp(){
   
   $('#submitPhone').hide()
  //  var otp = document.getElementById("otp").value;
  //  if(checker != 0 && timeLimit ){
  //  if( parseInt(otp.length ) == 6){
  //   checker--;
  //   document.getElementById("chanceIndicator").innerHTML = checker;
     
  //    document.getElementById('err').innerHTML = "";
  //    $.ajax({
  //      url:'/otpCheckForExistUser',
  //      data:{phone:phone, otp:otp ,  gustUserId : localStorage.getItem("userId")},
  //      method:"post",
  //      success :(result)=>{
  //       document.getElementById('id01').style.display = 'none'
  //         if(result.status === true){
  //          location.href = "/";
  //         }else{
  //           document.getElementById('err').innerHTML = result.status;
  //         }
  //      }
  //    })
     
  //  }else{
  //    document.getElementById("err").innerText = " ! Velachil  Edukalledey...."
  //  }
  // }else{

  //   swal("Sorry !", " Try again ", "error").then(() => {
  //           location.reload();
  //       })

  // }
 }

 function simpleSubmit (){
  
   var err = document.getElementById("err")
   err.style.display = "block";
  var pattern = /^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/;
  var email = document.getElementById("email").value;
  var password = document.getElementById("password").value;

  if(email.match(pattern) === null|| email == ""){
    err.innerHTML = "check your Email"
    return;
  }
  else if(password.length < 6 || password == ""){
    err.innerHTML = "Enter a Valid Password";
    return;

  }else{
    // document.getElementById('id01').style.display = 'block'
    err.innerHTML = "";
    $.ajax({
      url:"/signupWithEmail",
      data:{email:email , password : password , gustUserId : localStorage.getItem("userId")},
      method:"post",
      success : (result)=>{
        if(result.status === true){
          location.href = "/"
        }else{
          err.innerHTML = result.status;
        }
      }
    })
  }


 }

 
   </script>
 </body>
 </html>